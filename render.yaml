services:
  - type: web
    name: email-connector-backend
    env: python
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: PYTHON_VERSION
        value: 3.13.1

  # Dramatiq worker for background jobs (Gmail/Drive/Outlook sync)
  - type: worker
    name: cortex-dramatiq-worker
    env: python
    buildCommand: pip install -r requirements.txt
    startCommand: dramatiq app.services.background.tasks
    envVars:
      - key: PYTHON_VERSION
        value: 3.13.1

  # Scheduler for periodic entity deduplication (every 15 min)
  - type: worker
    name: cortex-scheduler
    env: python
    buildCommand: pip install -r requirements.txt
    startCommand: python -m app.services.background.scheduler
    envVars:
      - key: PYTHON_VERSION
        value: 3.13.1
