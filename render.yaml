services:
  - type: web
    name: email-connector-backend
    env: python
    buildCommand: ./render-build.sh
    startCommand: uvicorn main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: PYTHON_VERSION
        value: 3.12.8

  # Dramatiq worker for background jobs (Gmail/Drive/Outlook sync)
  - type: worker
    name: cortex-dramatiq-worker
    env: python
    buildCommand: ./render-build.sh
    startCommand: dramatiq app.services.background.tasks
    envVars:
      - key: PYTHON_VERSION
        value: 3.12.8

  # Entity deduplication cron job (every 15 minutes)
  - type: cron
    name: entity-deduplication
    schedule: "*/15 * * * *"
    env: python
    buildCommand: pip install -r requirements-dedup.txt
    startCommand: python -m app.services.deduplication.run_dedup_cli
    envVars:
      - key: PYTHON_VERSION
        value: 3.12.8

  # Daily intelligence generation (midnight daily)
  - type: cron
    name: daily-intelligence
    schedule: "0 0 * * *"
    env: python
    buildCommand: ./render-build.sh
    startCommand: python -m app.services.jobs.run_daily_intelligence
    envVars:
      - key: PYTHON_VERSION
        value: 3.12.8

  # Weekly intelligence generation (Monday 1am)
  - type: cron
    name: weekly-intelligence
    schedule: "0 1 * * 1"
    env: python
    buildCommand: ./render-build.sh
    startCommand: python -m app.services.jobs.run_weekly_intelligence
    envVars:
      - key: PYTHON_VERSION
        value: 3.12.8

  # Monthly intelligence generation (1st of month 2am)
  - type: cron
    name: monthly-intelligence
    schedule: "0 2 1 * *"
    env: python
    buildCommand: ./render-build.sh
    startCommand: python -m app.services.jobs.run_monthly_intelligence
    envVars:
      - key: PYTHON_VERSION
        value: 3.12.8
